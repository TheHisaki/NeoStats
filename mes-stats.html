<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mes Stats - NeoStats</title>
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="container">
        <div class="nav-brand">
          <a href="index.html">
            <h1>üìä NeoStats</h1>
          </a>
        </div>
        <button
          class="mobile-menu-toggle"
          id="mobileMenuToggle"
          aria-label="Menu"
        >
          ‚ò∞
        </button>
        <ul class="nav-menu" id="navMenu">
          <li><a href="index.html">Accueil</a></li>
          <li><a href="musculation.html">Musculation</a></li>
          <li><a href="mes-stats.html" class="active">Mes Stats</a></li>
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <div class="container">
        <div class="page-header">
          <h1 class="page-title">üìä Mes Statistiques</h1>
          <p class="page-subtitle">
            Consultez toutes vos performances en d√©tail
          </p>
        </div>

        <!-- Filters Section -->
        <section class="stats-filters-section">
          <div class="section-header">
            <h2>üîç Filtres</h2>
            <p>Filtrez vos statistiques pour une analyse pr√©cise</p>
          </div>

          <div class="filters-container">
            <!-- Category Filter -->
            <div class="filter-group">
              <label class="filter-label">
                <span class="filter-icon">üí™</span>
                Cat√©gorie musculaire
              </label>
              <select id="categoryFilter" class="filter-select">
                <option value="all">Toutes les cat√©gories</option>
              </select>
            </div>

            <!-- Exercise Filter -->
            <div class="filter-group">
              <label class="filter-label">
                <span class="filter-icon">üèãÔ∏è</span>
                Exercice
              </label>
              <select id="exerciseFilter" class="filter-select">
                <option value="all">Tous les exercices</option>
              </select>
            </div>

            <!-- Date Range Filter -->
            <div class="filter-group">
              <label class="filter-label">
                <span class="filter-icon">üìÖ</span>
                P√©riode
              </label>
              <div class="date-range-group">
                <input
                  type="date"
                  id="dateStart"
                  class="filter-date-input"
                  placeholder="Date de d√©but"
                />
                <span class="date-separator">‚Üí</span>
                <input
                  type="date"
                  id="dateEnd"
                  class="filter-date-input"
                  placeholder="Date de fin"
                />
              </div>
            </div>

            <!-- Clear Filters Button -->
            <div class="filter-group filter-group-button">
              <div class="filter-label filter-label-spacer">
                <span class="filter-icon">‚†Ä</span>
                <span style="opacity: 0">Placeholder</span>
              </div>
              <button id="clearFilters" class="btn btn-secondary">
                Effacer les filtres
              </button>
            </div>
          </div>
        </section>

        <!-- Stats Summary Cards -->
        <section class="stats-summary-section">
          <div class="stats-summary-grid">
            <div class="summary-card">
              <div class="summary-icon">üí™</div>
              <div class="summary-content">
                <h3 class="summary-label">Total d'exercices</h3>
                <p class="summary-value" id="totalExercises">0</p>
              </div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">üèãÔ∏è</div>
              <div class="summary-content">
                <h3 class="summary-label">Exercices diff√©rents</h3>
                <p class="summary-value" id="totalDifferentExercises">0</p>
              </div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">üìä</div>
              <div class="summary-content">
                <h3 class="summary-label">Total de s√©ries</h3>
                <p class="summary-value" id="totalSets">0</p>
              </div>
            </div>
            <div class="summary-card">
              <div class="summary-icon">üîÑ</div>
              <div class="summary-content">
                <h3 class="summary-label">Total de r√©p√©titions</h3>
                <p class="summary-value" id="totalReps">0</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Stats Table Section -->
        <section class="stats-table-section">
          <div class="section-header">
            <h2>üìã D√©tails des exercices</h2>
            <p>Toutes vos performances enregistr√©es</p>
          </div>

          <div class="stats-table-container">
            <table class="stats-table" id="statsTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Cat√©gorie</th>
                  <th>Exercice</th>
                  <th>Poids (kg)</th>
                  <th>R√©p√©titions</th>
                  <th>S√©ries</th>
                  <th>Volume (kg)</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="statsTableBody">
                <!-- Les donn√©es seront inject√©es ici -->
              </tbody>
            </table>
          </div>

          <div id="emptyStatsMessage" class="empty-state" style="display: none">
            <div class="empty-state-icon">üì≠</div>
            <h3>Aucune statistique</h3>
            <p>
              Vous n'avez pas encore de statistiques enregistr√©es. Commencez par
              ajouter un exercice dans la section Musculation.
            </p>
            <a href="musculation.html" class="btn btn-primary"
              >Ajouter un exercice</a
            >
          </div>
        </section>

        <!-- Exercise Stats Section -->
        <section class="exercise-stats-section">
          <div class="section-header">
            <h2>üìä Statistiques par exercice</h2>
            <p>Analyse d√©taill√©e de chaque exercice</p>
          </div>

          <div id="exerciseStatsContainer" class="exercise-stats-grid">
            <!-- Les cartes d'exercices seront inject√©es ici -->
          </div>
        </section>

        <!-- Progress Charts Section -->
        <section class="progress-charts-section">
          <div class="section-header">
            <h2>üìà Graphiques de progression</h2>
            <p>Visualisez votre √©volution dans le temps</p>
          </div>

          <div class="charts-container">
            <div class="chart-card">
              <h3>Progression du poids (kg)</h3>
              <canvas id="weightChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>√âvolution du volume (kg)</h3>
              <canvas id="volumeChart"></canvas>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <p>&copy; 2024 NeoStats. Tous droits r√©serv√©s.</p>
      </div>
    </footer>

    <script src="js/exercise-images.js"></script>
    <script src="js/exercise-muscle-zones.js"></script>
    <script src="js/musculation.js"></script>
    <script src="js/mes-stats.js"></script>
    <script>
      // Listen for storage events to reload stats when updated from another page
      // Note: storage event only fires in OTHER tabs/windows, not the current one
      window.addEventListener("storage", function (e) {
        if (e.key === "neostats_musculation") {
          console.log("Storage updated, reloading stats...");
          if (typeof loadAllStats === "function") {
            loadAllStats();
            if (typeof updateDisplay === "function") {
              updateDisplay();
            }
          }
        }
      });

      // Check for updates when page becomes visible (when coming back from another tab)
      document.addEventListener("visibilitychange", function () {
        if (!document.hidden && typeof loadAllStats === "function") {
          console.log("Page visible, reloading stats...");
          loadAllStats();
          if (typeof updateDisplay === "function") {
            updateDisplay();
          }
        }
      });

      // Reload when page gets focus (useful when coming back from musculation page)
      window.addEventListener("focus", function () {
        if (typeof loadAllStats === "function") {
          console.log("Page focused, reloading stats...");
          loadAllStats();
          if (typeof updateDisplay === "function") {
            updateDisplay();
          }
        }
      });

      // Also add a manual refresh after page load to ensure stats are loaded
      setTimeout(function () {
        if (
          typeof loadAllStats === "function" &&
          typeof updateDisplay === "function"
        ) {
          console.log("Refresh after page load...");
          loadAllStats();
          updateDisplay();
        }
      }, 500);
    </script>
  </body>
</html>
